# Описание конфига bareos

Все конфиги bareos лежат в **services/bareos/config**.

В **etc_bareos** лежат конфиги всех демонов bareos.

В **scripts** лежат скрипты для job bareos, которые могут быть добавлены в запуск до или после
бэкапа. Содержимое **scripts** должно лежать в **/usr/local/bin** хоста директора bareos.


## Director

Конфиги директора лежат в **etc_bareos/dir/bareos-dir.d**.

### base

В папке **base** лежат конфиги

- самого директора
- каталога bareos
- консолей
- сообщений
- профилей

Все эти конфиги взяты из документации, или дефолтных конфигов bareos почти без изменений.

### jobs

В папке **jobs** лежат конфиги всех job.

В файле **jobs/jobdefs.conf** находятся общие параметры для всех job (JobDefs):

- Job запускается каждую ночь
- Параллельный запуск одной job запрещен
- Время бэкапа ограничено 10 часами
- Полный бэкап выполняется с интервалом 1 месяц, остальные бэкапы - инкрементальные

Все остальные файлы - конкретные job-ы. 1 файл = 1 job = 1 клиент.

В каждом файле определено по 1 ресурсу:

- Job
- Client
- FileSet
- Storage
- Pool

При необходимости можно выносить FileSet, Storage и Pool в общие файлы и использовать в нескольких
job.

Файлы job в основном шаблонные, отличаются только значения некоторых параметров и наборы файлов.
Параметры прокоментированны в самих конфигах.

Storage и Pool определяются для каждой job отдельно потому что иначе нельзя сделать сохранение
файлов разных клиентов в разные папки.

Стратегия бэкапов - скользящее окно из двух цепочек "Полный-Инкрементальные".

Каждый месяц выполняется полный бэкап, после него в течение месяца - инкрементальные.
В один момент времени может существовать 1 или 2 цепочки. Если существует 2 цепочки, то прямо
перед выполнением полного бэкапа первая цепочка удаляется.

Удаляются как данные из каталога bareos, так и сами тома с их bootstrap файлами.

Подробное описание работы скользящего окна в
**services/bareos/config/scripts/remove_expired_volumes/README.md**

## Storage Daemon

Конфиги sd лежат в **etc_bareos/sd/bareos-sd.d**.

В **base** так же лежат конфиги, необходимые для работы storage daemon, не отличающиеся от
стандартных конфигов bareos.

В **devices/devices.conf** описаны все ресурсы **Device**. 1 ресурс = 1 клиент = 1 папка.


## File daemon

Конфиги fd лежат в **etc_bareos/fd/bareos-fd.d**.

Это стандартные конфиги bareos для клиента. Сейчас используется только для тестового клиента в
docker контейнере.


## Webui

Конфиги webui лежат в **etc_bareos/webui**.

Это стандартные конфиги webui bareos.


