Скопировать **template.env** в **.env** и заполнить переменные.


# Authelia

[Для authelia нужно настроить секреты](https://www.authelia.com/integration/deployment/docker/#using-secrets).

Создать файлы:

- **services/authelia/secrets/JWT_SECRET** - рандомная строка 32 символа

  ```bash
  LC_ALL=C tr -dc '[:graph:]' </dev/urandom | head -c 32; echo
  ```

- **services/authelia/secrets/STORAGE_ENCRYPTION_KEY** - рандомная строка 60+ символов

  ```bash
  LC_ALL=C tr -dc '[:graph:]' </dev/urandom | head -c 70; echo
  ```

Создать файл **services/authelia/config/users_database.yml**. В этом файле объявляются все
пользователи с хэшами паролей.

Пример такого файла:

```yaml
users:
  # Имя пользователя
  authelia:
    disabled: false
    displayname: "authelia"
    # Команда для генерации пароля:
    # docker exec -it authelia authelia crypto hash generate --config /config/configuration.yaml
    # Пароль - authelia
    password: "$6$rounds=50000$BpLnfgDsc2WD8F2q$Zis.ixdg9s/UOJYrs56b5QEZFiZECu0qZVNsIYxBaNJ7ucIL.nlxVCT5tqh8KHG8X4tlwCFm5r6NTOZZ5qRFN/"
    email: authelia@authelia.com
    groups:
      - admins
```


# Pi-hole

Для pi-hole настроена авторизация через authelia. Чтобы отключить встроенный в pi-hole пароль,
выполнить:

```bash
docker exec -it pihole pihole -a -p
docker compose up -d --force-recreate --no-deps pihole
```

В качестве альтернативы можно включить авторизацию **bypass** в authelia и установить свой
пароль pi-hole через переменные окружения в docker-compose:

```yaml
pihole:
   # ...
   environment:
      - WEBPASSWORD=${PIHOLE_WEB_PASSWORD}
```

# Gitea

На хосте нужно создать пользователя **git**:

```bash
sudo adduser git
```

Чтобы подключаться на хост и клонировать репозитории по ssh через стандартный порт (22), нужно
добавить [редирект подключений](https://docs.gitea.com/installation/install-with-docker#ssh-container-passthrough)
пользователя git на 2222 порт в **/etc/ssh/sshd_config**:

```ssh
Match User git
  AuthorizedKeysCommandUser git
  AuthorizedKeysCommand /usr/bin/ssh -p 2222 -o StrictHostKeyChecking=no git@127.0.0.1 /usr/local/bin/gitea keys -c /data/gitea/conf/app.ini -e git -u %u -t %t -k %k
```

Добавить файл **/usr/local/bin/gitea** с содержимым:

```bash
#!/bin/sh
ssh -p 2222 -o StrictHostKeyChecking=no git@127.0.0.1 "SSH_ORIGINAL_COMMAND=\"$SSH_ORIGINAL_COMMAND\" $0 $@"
```

