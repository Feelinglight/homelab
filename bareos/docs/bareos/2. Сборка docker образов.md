# Докер образы

У bareos нет официальных docker-образов, поэтому они собираются самостоятельно.

Файлы для сборки образа находятся в **./services/bareos/docker**

В Dockerfile описаны несколько образов (multistage build):

- bareos director (dir)
- bareos storage daemon (sd)
- bareos file daemon (fd)
- bareos webui

Собрать образы можно скриптом **build.sh**.

# Описание образов

Во все образы добавляются репозитории bareos, копируется скрипт **make_bareos_config.sh** и
entrypoint. У каждого образа свой файл entrypoint.

Cmd у всех образов кроме weui - соответствующий демон bareos (bareos-dir, bareos-sd, bareos-fd).
У webui cmd - nginx.

Все entrypoint-ы запускают скрипт **make_bareos_config.sh**.
Webui, кроме скрипта, запускает **php-fpm**.

Dir, кроме скрипта, может запускать создание или обновление таблиц базы данных bareos.

Для создания таблиц нужно установить переменную окружения ``DB_INIT=1``. Для обновления -
``DB_UPDATE=1``. Кроме того, в обоих случаях должны быть установлены переменные
``BAREOS__DB_HOST`` (адрес postgres), ``POSTGRES_ADMIN_USER`` (пользователь админ postgres) и
``POSTGRES_ADMIN_PASSWORD`` (пароль админа postgres).

Создание таблиц нужно при первом запуске bareos, потому что bareos не умеет делать это
самостоятельно. Обновление - при обновлении bareos.

## make_bareos_config.sh



